 #
# file: nuttx/drivers/Tupfile
#
# author: Freddie Chopin, http://www.distortec.com http://www.freddiechopin.info
# date: 2012-12-03
#

include_rules

include analog/files.mk
include bch/files.mk
include input/files.mk
include lcd/files.mk
include mmcsd/files.mk
include mtd/files.mk
include net/files.mk
include pipes/files.mk
include power/files.mk
include sensors/files.mk
include sercomm/files.mk
include serial/files.mk
include syslog/files.mk
include usbdev/files.mk
include usbhost/files.mk
include wireless/files.mk
include files.mk

# Add analog driver build support (the nested if-then-else implements an OR)
ifeq ($(CONFIG_DAC),y)
  CFLAGS += -I$(TOPDIR)/drivers/analog
else
ifeq ($(CONFIG_ADC),y)
  CFLAGS += -I$(TOPDIR)/drivers/analog
endif
endif

ifneq ($(CONFIG_NFILE_DESCRIPTORS),0)
ifneq ($(CONFIG_DISABLE_MOUNTPOINT),y)
	# Include BCH driver build support
	CFLAGS += -I$(TOPDIR)/drivers/bch
endif
endif

ifeq ($(CONFIG_INPUT),y)
	# Include input device driver build support
	CFLAGS += -I$(TOPDIR)/drivers/input
endif

ifeq ($(CONFIG_NX_LCDDRIVER),y)
	# Include LCD driver build support
	CFLAGS += -I(TOPDIR)/drivers/lcd
endif

ifeq ($(CONFIG_MMCSD),y)
	# Include MMC/SD driver build support
	CFLAGS += -I$(TOPDIR)/drivers/mmcsd
endif

POWER_CFLAGS =

ifeq ($(CONFIG_PM),y)
	# Include power management in the build
	POWER_CFLAGS := -I$(TOPDIR)/drivers/power
endif

ifeq ($(CONFIG_BATTERY),y)
	# Include battery suport in the build
	POWER_CFLAGS := -I$(TOPDIR)/drivers/power
endif

# Include power management in the build
CFLAGS += $(POWER_CFLAGS)

# Include sensor driver build support
CFLAGS += -I$(TOPDIR)/drivers/sensors

ifeq ($(CONFIG_USBDEV),y)
	# Include USB device build support
	CFLAGS += -I$(TOPDIR)/drivers/usbdev
endif

# Include USB host driver build logic
CFLAGS += -I$(TOPDIR)/drivers/usbhost

ifeq ($(CONFIG_WIRELESS),y)
	# Include wireless build support
	CFLAGS += -I$(TOPDIR)/drivers/wireless/cc1101
endif

: foreach $(ASRCS) |> !as |> {objects}
: foreach $(CSRCS) |> !cc |> {objects}
: foreach $(CXXSRCS) |> !cxx |> {objects}
: {objects} |> !ar |> lib%d.a
